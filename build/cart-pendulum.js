!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CP=e():t.CP=e()}(self,(function(){return(()=>{"use strict";var t,e={d:(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},i={};function n(t,e){this.min=t,this.max=e}function o(t,e){this.origin=t,this.end=e}function r(){this.barrierDistance=400,this.boxHalfSize=50,this.moveAcceleration=.2,this.limitAngle=.7,this.cart=new n(new t(-this.boxHalfSize,-30),new t(this.boxHalfSize,30)),this.pendulum=new o(new t(0,0),new t(0,100)),this.barrierLeft=new o(new t(-this.barrierDistance,-1e3),new t(-this.barrierDistance,1e3)),this.barrierRight=new o(new t(this.barrierDistance,-1e3),new t(this.barrierDistance,1e3)),this.reset()}function s(t,e){this.ori=t,this.decl=e}function a(){this.vel=new s(0,0),this.angle=new s(0,0),this.pos=new s(0,0),this.e=0}function h(){}function l(){}function c(){}return e.r(i),e.d(i,{Box:()=>n,Cart:()=>r,Line:()=>o,LinearModel:()=>a,LinearRegression:()=>s,Runner:()=>h,Training:()=>l,Utils:()=>c,Vector2:()=>t}),t=class{constructor(t,e){this.x=t,this.y=e}},n.prototype.getSize=function(){return new t(this.max.x-this.min.x,this.max.y-this.min.y)},n.prototype.draw=function(t){var e=this.getSize();t.lineWidth=3,t.strokeRect(this.min.x,this.min.y,e.x,e.y)},o.prototype.size=function(){return Math.sqrt(Math.pow(this.origin.x-this.end.x,2)+Math.pow(this.origin.y-this.end.y,2))},o.prototype.draw=function(t){t.lineWidth=3,t.beginPath(),t.moveTo(this.origin.x,this.origin.y),t.lineTo(this.end.x,this.end.y),t.stroke()},r.prototype.reset=function(){this.gameOver=!1,this.score=0,this.position=0,this.leftPressed=!1,this.rightPressed=!1,this.acceleration=0,this.friction=.99,this.velocity=2*Math.random()-1,this.velocity+=this.velocity<0?-.2:.2,this.angle=0},r.prototype.draw=function(t){this.barrierLeft.draw(t),this.barrierRight.draw(t),t.translate(this.position,0),t.strokeStyle="#FF0000",t.lineWidth=1,t.beginPath(),t.moveTo(100*Math.sin(-this.limitAngle),100*Math.cos(-this.limitAngle)),t.lineTo(0,0),t.lineTo(100*Math.sin(this.limitAngle),100*Math.cos(this.limitAngle)),t.stroke(),t.strokeStyle="#000000",t.lineWidth=3,this.pendulum.end.x=100*Math.sin(this.angle),this.pendulum.end.y=100*Math.cos(this.angle),this.pendulum.draw(t),this.cart.draw(t)},r.prototype.update=function(){this.gameOver||(this.leftPressed?this.acceleration=-this.moveAcceleration:this.rightPressed?this.acceleration=this.moveAcceleration:this.acceleration=0,this.velocity+=this.acceleration,this.velocity*=this.friction,this.position+=this.velocity,this.angle+=.03*this.angle+.005*-this.velocity,this.score++,(this.angle>this.limitAngle||this.angle<-this.limitAngle)&&(this.gameOver=!0),(this.position+this.boxHalfSize>this.barrierDistance||this.position-this.boxHalfSize<-this.barrierDistance)&&(this.gameOver=!0))},s.prototype.jitter=function(t){this.ori+=(Math.random()-.5)*t,this.decl+=(Math.random()-.5)*t},s.prototype.clone=function(){return new s(this.ori,this.decl)},a.prototype.jitter=function(t){this.vel.jitter(t),this.angle.jitter(t),this.pos.jitter(t),this.e+=(Math.random()-.5)*t},a.prototype.clone=function(){var t=new a;return t.vel=this.pos.clone(),t.angle=this.pos.clone(),t.pos=this.pos.clone(),t.e=this.e,t},a.prototype.control=function(t){var e=this.vel.decl*t.velocity+this.vel.ori,i=this.angle.decl*t.angle+this.angle.ori+e+(this.pos.decl*t.position+this.pos.ori);t.leftPressed=i<this.e,t.rightPressed=i>this.e},h.runHeadless=function(t,e,i){e=void 0!==e?e:1/0;var n=new r;if(i)var o=performance.now();for(;!n.gameOver&&n.score<e;)void 0!==t&&t(n),n.update();if(i){var s=performance.now();console.log(" - Simulation ended with "+n.score+" points, took "+(s-o)+".")}return n.score},h.runGraphical=function(t,e,i){var n=new r,o=t.getContext("2d"),s=0;!function r(){void 0!==e&&e(n),n.update(),n.gameOver&&(void 0!==i&&i(n,s),n.score>s&&(s=n.score),n.reset()),o.save(),o.clearRect(0,0,t.width,t.height),o.font="15px Arial",o.textAlign="left",o.fillText("Points: "+n.score,10,20),o.fillText("Max: "+s,10,40),o.transform(1,0,0,-1,0,t.height),o.translate(t.width/2,t.height/2),n.draw(o),o.restore(),requestAnimationFrame(r)}()},l.trainIterative=function(t,e,i,n){t=void 0!==t?t:500,e=void 0!==e?e:100,i=void 0!==i?i:5,n=void 0!==n?n:2e3,console.log(" - Training process starting. ",{epochs:t,iterations:e,runs:i});for(var o=new a,r=l.testModel(o,i,n),s=0;s<t;s++){console.log(" - Running epoch ",s," score ",r);for(var h=null,c=0,d=0;d<e;d++){var u=o.clone();u.jitter(1);var f=l.testModel(u,i,n);f>c&&(h=u,c=f)}if(c>=r&&(o=h,r=c),r>=n)break}return console.log(" - Training finished with score ",r," model ",o),o},l.trainRandom=function(t,e,i){t=void 0!==t?t:1e5,e=void 0!==e?e:5,i=void 0!==i?i:2e3,console.log(" - Training process starting. ",{iterations:t,runs:e});for(var n=null,o=0,r=0;r<t;r++){var s=new a;s.jitter(2);var h=l.testModel(s,e,i);if(h>o&&(n=s,o=h),console.log(" - Iteration ",r," score ",o),o>=i)break}return console.log(" - Training finished with score ",o," model ",n),n},l.testModel=function(t,e,i){for(var n=0,o=0;o<e;o++)n+=h.runHeadless((function(e){t.control(e)}),i);return n/e},c.writeFile=function(t,e){"object"==typeof t&&(t=JSON.stringify(t,null,"\t"));var i=new Blob([t],{type:"octet/stream"}),n=document.createElement("a");n.download=e,n.href=window.URL.createObjectURL(i),n.style.display="none",n.onclick=function(){document.body.removeChild(this)},document.body.appendChild(n),n.click()},c.readFile=function(t){var e=document.createElement("input");e.type="file",e.style.display="none",document.body.appendChild(e),e.onchange=function(){var i=e.files;if(0!==i.length){var n=new FileReader;n.onload=function(){var e=n.result;t(e)},n.readAsText(i[0]),document.body.removeChild(e)}},e.click()},i})()}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Iiwid2VicGFjazovL0NQL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL0NQLy4vc291cmNlL1ZlY3RvcjIuY29mZmVlIiwid2VicGFjazovL0NQL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9DUC93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL0NQL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vQ1AvLi9zb3VyY2UvQm94LmpzIiwid2VicGFjazovL0NQLy4vc291cmNlL0xpbmUuanMiLCJ3ZWJwYWNrOi8vQ1AvLi9zb3VyY2UvQ2FydC5qcyIsIndlYnBhY2s6Ly9DUC8uL3NvdXJjZS9MaW5lYXJSZWdyZXNzaW9uLmpzIiwid2VicGFjazovL0NQLy4vc291cmNlL0xpbmVhck1vZGVsLmpzIiwid2VicGFjazovL0NQLy4vc291cmNlL1J1bm5lci5qcyIsIndlYnBhY2s6Ly9DUC8uL3NvdXJjZS9UcmFpbmluZy5qcyIsIndlYnBhY2s6Ly9DUC8uL3NvdXJjZS9VdGlscy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJDUFwiXSA9IGZhY3RvcnkoKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJDUFwiXSA9IGZhY3RvcnkoKTtcbn0pKHNlbGYsIGZ1bmN0aW9uKCkge1xucmV0dXJuICIsIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCIjIyNcclxuMkQgVmVjdG9yIG9iamVjdCByZXByZXNlbnRlZCBieSB4IGFuZCB5IGNvb3JkaW5hdGVzLlxyXG5cclxuQHBhcmFtIHtudW1iZXJ9IHggXHJcbkBwYXJhbSB7bnVtYmVyfSB5IFxyXG4jIyNcclxuY2xhc3MgVmVjdG9yMlxyXG4gICAgY29uc3RydWN0b3I6ICh4LCB5KSAtPiBcclxuICAgICAgICBAeCA9IHhcclxuICAgICAgICBAeSA9IHlcclxuXHJcbmV4cG9ydCB7VmVjdG9yMn0iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiaW1wb3J0IHtWZWN0b3IyfSBmcm9tIFwiLi9WZWN0b3IyLmNvZmZlZVwiO1xyXG5cclxuLyoqXHJcbiAqIEJveCBpcyByZXByZXNlbnRlZCBmcm9tIGEgbWluaW11bSBhbmQgYSBtYXhpbXVtIHBvaW50cy5cclxuICogXHJcbiAqIEBwYXJhbSB7VmVjdG9yMn0gbWluIFxyXG4gKiBAcGFyYW0ge1ZlY3RvcjJ9IG1heCBcclxuICovXHJcbmZ1bmN0aW9uIEJveChtaW4sIG1heClcclxue1xyXG4gICAgdGhpcy5taW4gPSBtaW47XHJcbiAgICB0aGlzLm1heCA9IG1heDtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCB0aGUgc2l6ZSBvZiB0aGUgYm94IGluIGEgVmVjdG9yLlxyXG4gKiBcclxuICogQHJldHVybnMge1ZlY3RvcjJ9IFNpemUgb2YgdGhlIGJveC4gXHJcbiAqL1xyXG5Cb3gucHJvdG90eXBlLmdldFNpemUgPSBmdW5jdGlvbigpXHJcbntcclxuICAgIHJldHVybiBuZXcgVmVjdG9yMih0aGlzLm1heC54IC0gdGhpcy5taW4ueCwgdGhpcy5tYXgueSAtIHRoaXMubWluLnkpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIERyYXcgdGhlIGJveCBpbnRvIGEgY29udGV4dCBmb3IgdmlzdWFsaXphdGlvbi5cclxuICogXHJcbiAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjb250ZXh0IFxyXG4gKi9cclxuQm94LnByb3RvdHlwZS5kcmF3ID0gZnVuY3Rpb24oY29udGV4dClcclxue1xyXG4gICAgdmFyIHNpemUgPSB0aGlzLmdldFNpemUoKTtcclxuICAgIGNvbnRleHQubGluZVdpZHRoID0gMztcclxuICAgIGNvbnRleHQuc3Ryb2tlUmVjdCh0aGlzLm1pbi54LCB0aGlzLm1pbi55LCBzaXplLngsIHNpemUueSk7XHJcbn07XHJcblxyXG5leHBvcnQge0JveH07IiwiaW1wb3J0IHtWZWN0b3IyfSBmcm9tIFwiLi9WZWN0b3IyLmNvZmZlZVwiO1xyXG5cclxuLyoqXHJcbiAqIExpbmUgYmV0d2VlbiB0d28gcG9pbnRzIChvcmlnaW4gdG8gZW5kKS5cclxuICogXHJcbiAqIEBwYXJhbSB7VmVjdG9yMn0gb3JpZ2luIFxyXG4gKiBAcGFyYW0ge1ZlY3RvcjJ9IGVuZCBcclxuICovXHJcbmZ1bmN0aW9uIExpbmUob3JpZ2luLCBlbmQpXHJcbntcclxuICAgIHRoaXMub3JpZ2luID0gb3JpZ2luO1xyXG4gICAgdGhpcy5lbmQgPSBlbmQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDYWxjdWxhdGUgdGhlIGRpdGFuY2UgYmV0d2VlbiB0aGUgb3JpZ2luIGFuZCBlbmQgcG9pbnRzLlxyXG4gKiBcclxuICogQHJldHVybnMge251bWJlcn0gU2l6ZSBvZiB0aGUgbGluZS5cclxuICovXHJcbkxpbmUucHJvdG90eXBlLnNpemUgPSBmdW5jdGlvbigpXHJcbntcclxuICAgIHJldHVybiBNYXRoLnNxcnQoTWF0aC5wb3codGhpcy5vcmlnaW4ueCAtIHRoaXMuZW5kLngsIDIpICsgTWF0aC5wb3codGhpcy5vcmlnaW4ueSAtIHRoaXMuZW5kLnksIDIpKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBEcmF3IHRoZSBsaW5lIGludG8gYSBjYW52YXMgMkQgY29udGV4dC5cclxuICogXHJcbiAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjb250ZXh0IFxyXG4gKi9cclxuTGluZS5wcm90b3R5cGUuZHJhdyA9IGZ1bmN0aW9uKGNvbnRleHQpXHJcbntcclxuICAgIGNvbnRleHQubGluZVdpZHRoID0gMztcclxuICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7XHJcbiAgICBjb250ZXh0Lm1vdmVUbyh0aGlzLm9yaWdpbi54LCB0aGlzLm9yaWdpbi55KTtcclxuICAgIGNvbnRleHQubGluZVRvKHRoaXMuZW5kLngsIHRoaXMuZW5kLnkpO1xyXG4gICAgY29udGV4dC5zdHJva2UoKTtcclxufTtcclxuXHJcbmV4cG9ydCB7TGluZX07IiwiaW1wb3J0IHtWZWN0b3IyfSBmcm9tIFwiLi9WZWN0b3IyLmNvZmZlZVwiO1xyXG5pbXBvcnQge0xpbmV9IGZyb20gXCIuL0xpbmVcIjtcclxuaW1wb3J0IHtCb3h9IGZyb20gXCIuL0JveFwiO1xyXG5cclxuLyoqXHJcbiAqIENhcnQgb2JqZWN0LCB0aGF0IGNvbnRhaW5zIHRoZSBlbnRpcmUgbG9naWMgZm9yIHRoZSBzaW11bGF0aW9uLlxyXG4gKiBcclxuICogVGhlIGNhcnQgY2FuIGJlIGNvbmZpZ3VyZWRcclxuICovXHJcbmZ1bmN0aW9uIENhcnQoKVxyXG57XHJcbiAgICAvKipcclxuICAgICAqIERpc3RhbmNlIG9mIHRoZSBiYXJyaWVycyByZWxhdGl2ZSB0byB0aGUgY2VudGVyLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmJhcnJpZXJEaXN0YW5jZSA9IDQwMDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEhhbGYgdGhlIHNpemUgb2YgdGhlIGNhcnQgYm94LlxyXG4gICAgICovXHJcbiAgICB0aGlzLmJveEhhbGZTaXplID0gNTA7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBY2NlbGVyYXRpb24gdXNlZCBmb3IgbW92ZW1lbnQgb2YgdGhlIGNhcnQgb24ga2V5IHByZXNzLlxyXG4gICAgICovXHJcbiAgICB0aGlzLm1vdmVBY2NlbGVyYXRpb24gPSAwLjI7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBMaW1pdCBhbmdsZSB0aGF0IHRoZSBwZW5kdWx1bSBjYW4gcmVhY2guXHJcbiAgICAgKi9cclxuICAgIHRoaXMubGltaXRBbmdsZSA9IDAuNztcclxuXHJcbiAgICAvKipcclxuICAgICAqIEJveCB0aGF0IHJlcHJlc2VudHMgdGhlIGNhcnQuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuY2FydCA9IG5ldyBCb3gobmV3IFZlY3RvcjIoLXRoaXMuYm94SGFsZlNpemUsIC0zMCksIG5ldyBWZWN0b3IyKHRoaXMuYm94SGFsZlNpemUsIDMwKSk7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBMaW5lIHRvIHJlcHJlc2VudCB0aGUgcGVuZHVsdW1cclxuICAgICAqL1xyXG4gICAgdGhpcy5wZW5kdWx1bSA9IG5ldyBMaW5lKG5ldyBWZWN0b3IyKDAsIDApLCBuZXcgVmVjdG9yMigwLCAxMDApKTtcclxuICAgIFxyXG4gICAgLyoqXHJcbiAgICAgKiBMZWZ0IGJhcnJpZXIgbGltaXQuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYmFycmllckxlZnQgPSBuZXcgTGluZShuZXcgVmVjdG9yMigtdGhpcy5iYXJyaWVyRGlzdGFuY2UsIC0xMDAwKSwgbmV3IFZlY3RvcjIoLXRoaXMuYmFycmllckRpc3RhbmNlLCAxMDAwKSk7XHJcbiAgICBcclxuICAgIC8qKlxyXG4gICAgICogUmlnaHQgYmFycmllciBsaW1pdC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5iYXJyaWVyUmlnaHQgPSBuZXcgTGluZShuZXcgVmVjdG9yMih0aGlzLmJhcnJpZXJEaXN0YW5jZSwgLTEwMDApLCBuZXcgVmVjdG9yMih0aGlzLmJhcnJpZXJEaXN0YW5jZSwgMTAwMCkpO1xyXG4gICAgdGhpcy5yZXNldCgpO1xyXG59XHJcblxyXG5cclxuXHJcbi8qKlxyXG4gKiBSZXNldCB0aGUgc2ltdWxhdGlvbiBwYXJhbWV0ZXJzIGJhY2sgdG8gYSBpbml0aWFsIHN0YXRlLlxyXG4gKiBcclxuICogVGhlIGluaXRpYWwgdmVsb2NpdHkgb2YgdGhlIGNhcnQgaXMgcmFuZG9taXplZC5cclxuICovXHJcbkNhcnQucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKVxyXG57XHJcbiAgICB0aGlzLmdhbWVPdmVyID0gZmFsc2U7XHJcbiAgICB0aGlzLnNjb3JlID0gMDtcclxuICAgIHRoaXMucG9zaXRpb24gPSAwO1xyXG4gICAgdGhpcy5sZWZ0UHJlc3NlZCA9IGZhbHNlO1xyXG4gICAgdGhpcy5yaWdodFByZXNzZWQgPSBmYWxzZTtcclxuICAgIHRoaXMuYWNjZWxlcmF0aW9uID0gMC4wO1xyXG4gICAgdGhpcy5mcmljdGlvbiA9IDAuOTk7XHJcbiAgICB0aGlzLnZlbG9jaXR5ID0gKE1hdGgucmFuZG9tKCkgKiAyIC0gMS4wKTtcclxuICAgIHRoaXMudmVsb2NpdHkgKz0gdGhpcy52ZWxvY2l0eSA8IDAgPyAtMC4yIDogMC4yO1xyXG4gICAgdGhpcy5hbmdsZSA9IDA7XHJcbn07XHJcblxyXG4vKipcclxuICogRHJhdyB0aGUgc2ltdWxhdGlvbiB0byBhIGNvbnRleHQgMkQgZm9yIHZpc3VhbGl6YXRpb24uXHJcbiAqIFxyXG4gKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY29udGV4dCBcclxuICovXHJcbkNhcnQucHJvdG90eXBlLmRyYXcgPSBmdW5jdGlvbihjb250ZXh0KVxyXG57XHJcbiAgICB0aGlzLmJhcnJpZXJMZWZ0LmRyYXcoY29udGV4dCk7XHJcbiAgICB0aGlzLmJhcnJpZXJSaWdodC5kcmF3KGNvbnRleHQpO1xyXG5cclxuICAgIGNvbnRleHQudHJhbnNsYXRlKHRoaXMucG9zaXRpb24sIDApO1xyXG5cclxuICAgIC8vIEd1aWRlbGluZXNcclxuICAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSBcIiNGRjAwMDBcIjtcclxuICAgIGNvbnRleHQubGluZVdpZHRoID0gMTtcclxuICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7XHJcbiAgICBjb250ZXh0Lm1vdmVUbyhNYXRoLnNpbigtdGhpcy5saW1pdEFuZ2xlKSAqIDEwMCwgTWF0aC5jb3MoLXRoaXMubGltaXRBbmdsZSkgKiAxMDApO1xyXG4gICAgY29udGV4dC5saW5lVG8oMCwgMCk7XHJcbiAgICBjb250ZXh0LmxpbmVUbyhNYXRoLnNpbih0aGlzLmxpbWl0QW5nbGUpICogMTAwLCBNYXRoLmNvcyh0aGlzLmxpbWl0QW5nbGUpICogMTAwKTtcclxuICAgIGNvbnRleHQuc3Ryb2tlKCk7XHJcblxyXG4gICAgY29udGV4dC5zdHJva2VTdHlsZSA9IFwiIzAwMDAwMFwiO1xyXG4gICAgY29udGV4dC5saW5lV2lkdGggPSAzO1xyXG4gICAgdGhpcy5wZW5kdWx1bS5lbmQueCA9IE1hdGguc2luKHRoaXMuYW5nbGUpICogMTAwO1xyXG4gICAgdGhpcy5wZW5kdWx1bS5lbmQueSA9IE1hdGguY29zKHRoaXMuYW5nbGUpICogMTAwO1xyXG4gICAgdGhpcy5wZW5kdWx1bS5kcmF3KGNvbnRleHQpO1xyXG4gICAgdGhpcy5jYXJ0LmRyYXcoY29udGV4dCk7XHJcbn07XHJcblxyXG4vKipcclxuICogVXBkYXRlIHRoZSBsb2dpYyBvZiB0aGUgc2ltdWxhdGlvbi5cclxuICogXHJcbiAqIFRoZSBjYXJ0IG1vdmVzIGFjY29yZGluZyB0byBpdHMgdmVsb2NpdHksIHRoZSBzdGljayBpcyB1c2VkIGJhc2VkIG9uIHZlbG9jaXR5IGFuZCBpdHMgY3VycmVudCBhbmdsZSAoZ3Jhdml0eSkuXHJcbiAqL1xyXG5DYXJ0LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpXHJcbntcclxuICAgIC8vIElmIGdhbWUgb3ZlciByZXR1cm5cclxuICAgIGlmKHRoaXMuZ2FtZU92ZXIpXHJcbiAgICB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFByb2Nlc3Mga2V5IHByZXNzZXNcclxuICAgIGlmKHRoaXMubGVmdFByZXNzZWQpe3RoaXMuYWNjZWxlcmF0aW9uID0gLXRoaXMubW92ZUFjY2VsZXJhdGlvbjt9XHJcbiAgICBlbHNlIGlmKHRoaXMucmlnaHRQcmVzc2VkKXt0aGlzLmFjY2VsZXJhdGlvbiA9IHRoaXMubW92ZUFjY2VsZXJhdGlvbjt9XHJcbiAgICBlbHNlIHt0aGlzLmFjY2VsZXJhdGlvbiA9IDAuMDt9XHJcblxyXG4gICAgLy8gVXBkYXRlIHBoeXNpY3NcclxuICAgIHRoaXMudmVsb2NpdHkgKz0gdGhpcy5hY2NlbGVyYXRpb247XHJcbiAgICB0aGlzLnZlbG9jaXR5ICo9IHRoaXMuZnJpY3Rpb247XHJcbiAgICB0aGlzLnBvc2l0aW9uICs9IHRoaXMudmVsb2NpdHk7XHJcblxyXG4gICAgdGhpcy5hbmdsZSArPSAodGhpcy5hbmdsZSAqIDNlLTIpICsgKC10aGlzLnZlbG9jaXR5ICogNWUtMyk7XHJcbiAgICB0aGlzLnNjb3JlKys7XHJcblxyXG4gICAgLy8gSWYgdGhlIGFuZ2xlIG9mIHRoZSBwZW5kdWx1bSBkcm9wIGJlbGxvdyB0aGUgbWluaXVtIGVuZCB0aGUgZ2FtZVxyXG4gICAgaWYodGhpcy5hbmdsZSA+IHRoaXMubGltaXRBbmdsZSB8fCB0aGlzLmFuZ2xlIDwgLXRoaXMubGltaXRBbmdsZSlcclxuICAgIHtcclxuICAgICAgICB0aGlzLmdhbWVPdmVyID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJZiB0aGUgY2FydCBoaXRzIHRoZSBiYXJyaWVkIGVuZCB0aGUgZ2FtZVxyXG4gICAgaWYodGhpcy5wb3NpdGlvbiArIHRoaXMuYm94SGFsZlNpemUgPiB0aGlzLmJhcnJpZXJEaXN0YW5jZSB8fCB0aGlzLnBvc2l0aW9uIC0gdGhpcy5ib3hIYWxmU2l6ZSA8IC10aGlzLmJhcnJpZXJEaXN0YW5jZSlcclxuICAgIHtcclxuICAgICAgICB0aGlzLmdhbWVPdmVyID0gdHJ1ZTtcclxuICAgIH1cclxufTtcclxuXHJcbmV4cG9ydCB7Q2FydH07IiwiLyoqXHJcbiAqIExpbmVhciByZWdyZXNzaW9uIGlzIHJlcHJlc2VudGVkIGJ5IHR3byBwYXJhbWV0ZXJzOiB0aGUgb3JpZ2luIGFuZCBzbG9wZSBvZiB0aGUgbGluZS5cclxuICogXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBvcmkgT3JpZ2luIG9mIHRoZSBsaW5lLlxyXG4gKiBAcGFyYW0ge251bWJlcn0gZGVjbCBTbG9wZSBvZiB0aGUgbGluZS5cclxuICovXHJcbmZ1bmN0aW9uIExpbmVhclJlZ3Jlc3Npb24ob3JpLCBkZWNsKVxyXG57XHJcbiAgICB0aGlzLm9yaSA9IG9yaTtcclxuICAgIHRoaXMuZGVjbCA9IGRlY2w7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBKaXR0ZXIgdGhlIHZhbHVlcyBpbiB0aGUgcmVncmVzc2lvbiByYW5kb21seS5cclxuICogXHJcbiAqIFVzZWZ1bGwgZm9yIHRyYWluaW5nIHB1cnBvc2VzLlxyXG4gKiBcclxuICogQHBhcmFtIHtudW1iZXJ9IHNjYWxlIFNjYWxlIG9mIHRoZSBqaXR0ZXJpbmcuIFxyXG4gKi9cclxuTGluZWFyUmVncmVzc2lvbi5wcm90b3R5cGUuaml0dGVyID0gZnVuY3Rpb24oc2NhbGUpIHtcclxuICAgIHRoaXMub3JpICs9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIHNjYWxlO1xyXG4gICAgdGhpcy5kZWNsICs9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIHNjYWxlO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhIGNvcHkgb2YgdGhlIGxpbmVhciByZWdyZXNzaW9uIG9iamVjdC5cclxuICogXHJcbiAqIEByZXR1cm5zIENsb25lIG9mIHRoZSBsaW5lYXIgcmVncmVzc2lvbiBvYmplY3QuXHJcbiAqL1xyXG5MaW5lYXJSZWdyZXNzaW9uLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKClcclxue1xyXG4gICAgcmV0dXJuIG5ldyBMaW5lYXJSZWdyZXNzaW9uKHRoaXMub3JpLCB0aGlzLmRlY2wpO1xyXG59O1xyXG5cclxuZXhwb3J0IHtMaW5lYXJSZWdyZXNzaW9ufTsiLCJpbXBvcnQge0xpbmVhclJlZ3Jlc3Npb259IGZyb20gXCIuL0xpbmVhclJlZ3Jlc3Npb25cIjtcclxuXHJcbi8qKlxyXG4gKiBNb2RlbCB0byBjb250cm9sIHRoZSBjYXJ0LCBpdHMgcGFyYW1ldGVycyBjYW4gYmUgc2V0IGFuZCB1c2VkIHRvIGNvbnRyb2wgdGhlIGNhcnQuXHJcbiAqIFxyXG4gKiBUaGUgbW9kZWwgaXMgY29tcG9zZWQgb2YgMyBsaW5lYXIgcmVncmVzc2lvbnMgZm9yIHdpY2ggdGhlaXIgcGFyYW1ldGVycyBjYW4gYmUgdHJhaW5lZCBhbmQgdXNlZCB0byBjb250cm9sIHRoZSBjYXJ0IG9iamVjdC5cclxuICovXHJcbmZ1bmN0aW9uIExpbmVhck1vZGVsKClcclxue1xyXG5cdHRoaXMudmVsID0gbmV3IExpbmVhclJlZ3Jlc3Npb24oMCwgMC4wKTtcclxuXHJcblx0dGhpcy5hbmdsZSA9IG5ldyBMaW5lYXJSZWdyZXNzaW9uKDAsIDAuMCk7XHJcblxyXG5cdHRoaXMucG9zID0gbmV3IExpbmVhclJlZ3Jlc3Npb24oMCwgMC4wKTtcclxuXHJcblx0dGhpcy5lID0gMC4wO1xyXG59XHJcblxyXG5MaW5lYXJNb2RlbC5wcm90b3R5cGUuaml0dGVyID0gZnVuY3Rpb24oc2NhbGUpXHJcbntcclxuXHR0aGlzLnZlbC5qaXR0ZXIoc2NhbGUpO1xyXG5cdHRoaXMuYW5nbGUuaml0dGVyKHNjYWxlKTtcclxuXHR0aGlzLnBvcy5qaXR0ZXIoc2NhbGUpO1xyXG5cclxuXHR0aGlzLmUgKz0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc2NhbGU7XHJcbn07XHJcblxyXG5MaW5lYXJNb2RlbC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbigpXHJcbntcclxuXHR2YXIgbSA9IG5ldyBMaW5lYXJNb2RlbCgpO1xyXG5cdFxyXG5cdG0udmVsID0gdGhpcy5wb3MuY2xvbmUoKTtcclxuXHRtLmFuZ2xlID0gdGhpcy5wb3MuY2xvbmUoKTtcclxuXHRtLnBvcyA9IHRoaXMucG9zLmNsb25lKCk7XHJcblx0bS5lID0gdGhpcy5lO1xyXG5cclxuXHRyZXR1cm4gbTtcclxufVxyXG5cclxuTGluZWFyTW9kZWwucHJvdG90eXBlLmNvbnRyb2wgPSBmdW5jdGlvbihjYXJ0KVxyXG57XHJcblx0dmFyIHYgPSB0aGlzLnZlbC5kZWNsICogY2FydC52ZWxvY2l0eSArIHRoaXMudmVsLm9yaTtcclxuXHR2YXIgYSA9IHRoaXMuYW5nbGUuZGVjbCAqIGNhcnQuYW5nbGUgKyB0aGlzLmFuZ2xlLm9yaVxyXG5cdHZhciBwID0gdGhpcy5wb3MuZGVjbCAqIGNhcnQucG9zaXRpb24gKyB0aGlzLnBvcy5vcmk7XHJcblxyXG5cdHZhciB2YWx1ZSA9IGEgKyB2ICsgcDtcclxuXHJcblx0Y2FydC5sZWZ0UHJlc3NlZCA9IHZhbHVlIDwgdGhpcy5lO1xyXG5cdGNhcnQucmlnaHRQcmVzc2VkID0gdmFsdWUgPiB0aGlzLmU7XHJcbn07XHJcblxyXG5leHBvcnQge0xpbmVhck1vZGVsfTsiLCJpbXBvcnQge0NhcnR9IGZyb20gXCIuL0NhcnRcIjtcclxuXHJcbi8qKlxyXG4gKiBNZXRob2RzIHRvIHJ1biB0aGUgc2ltdWxhdGlvbiBpbiBoZWFkbGVzcyBtb2RlICh0ZXJtaW5hbCBvbmx5KSwgb3IgYXR0YWNoZWQgdG8gYSBjYW52YXMgKEdyYXBoaWNhbCkuXHJcbiAqL1xyXG5mdW5jdGlvbiBSdW5uZXIoKSB7fVxyXG5cclxuLyoqXHJcbiAqIFJ1biB0aGUgc2ltdWxhdGlvbiBoZWFkbGVzc2x5IChpbiB0ZXJtaW5hbCkuXHJcbiAqIFxyXG4gKiBUaGUgc2ltdWxhdGlvbiBpcyBydW4gdW50aWwgdGhlIHN0aWNrIGlzIGRyb3BwZWQgb2ZmLlxyXG4gKiBcclxuICogQHBhcmFtIHtGdW5jdGlvbn0gbG9naWNDYWxsYmFjayBDYWxsYmFjayBtZXRob2QgdG8gcHJvY2VzcyB0aGUgY2FydCBsb2dpYy5cclxuICogQHBhcmFtIHtudW1iZXJ9IHBvaW50TGltaXQgSG93IG11Y2ggdGltZSB0byBzaW11bGF0ZSBpbiB0aGUgbGltaXQgKHByZXZlbnQgaW5maW5pdGUgcnVuKS5cclxuICogQHBhcmFtIHtib29sZWFufSBsb2dQZXJmb3JtYW5jZSBJZiB0cnVlIGNvbnNvbGUgbG9ncyB3aXRoIHBlcmZvcm1hbmNlIG9mIHRoZSBzaW11bGF0aW9uIGFyZSBwcmludGVkIG91dC5cclxuICogQHJldHVybnMgUmV0dXJucyB0aGUgYW1tb3VudCBvZiBwb2ludHMgYWNjdW11bGF0ZWQgZHVyaW5nIHRoZSBzaW11bGF0aW9uLlxyXG4gKi9cclxuUnVubmVyLnJ1bkhlYWRsZXNzID0gZnVuY3Rpb24obG9naWNDYWxsYmFjaywgcG9pbnRMaW1pdCwgbG9nUGVyZm9ybWFuY2UpXHJcbntcclxuICAgIHBvaW50TGltaXQgPSBwb2ludExpbWl0ICE9PSB1bmRlZmluZWQgPyBwb2ludExpbWl0IDogSW5maW5pdHk7XHJcblxyXG4gICAgdmFyIGNhcnQgPSBuZXcgQ2FydCgpO1xyXG4gICAgXHJcbiAgICBpZihsb2dQZXJmb3JtYW5jZSlcclxuICAgIHtcclxuICAgICAgICB2YXIgdGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG4gICAgfVxyXG5cclxuICAgIHdoaWxlKCFjYXJ0LmdhbWVPdmVyICYmIGNhcnQuc2NvcmUgPCBwb2ludExpbWl0KVxyXG4gICAge1x0XHJcbiAgICAgICAgaWYobG9naWNDYWxsYmFjayAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbG9naWNDYWxsYmFjayhjYXJ0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNhcnQudXBkYXRlKCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmKGxvZ1BlcmZvcm1hbmNlKVxyXG4gICAge1xyXG4gICAgICAgIHZhciBlbmQgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coXCIgLSBTaW11bGF0aW9uIGVuZGVkIHdpdGggXCIgKyBjYXJ0LnNjb3JlICsgXCIgcG9pbnRzLCB0b29rIFwiICsgKGVuZCAtIHRpbWUpICsgXCIuXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBjYXJ0LnNjb3JlO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFJ1biB0aGUgc2ltdWxhdGlvbiB3aXRoIHZpc3VhbGl6YXRpb24sIChhdHRhY2hlZCB0byBhIGNhbnZhcykuXHJcbiAqIFxyXG4gKiBSdW5zIGF0IHJlYWwgdGltZSBzcGVlZCBmb3IgdmlzdWFsaXphdGlvbiBwdXJwb3Nlcy5cclxuICogXHJcbiAqIEBwYXJhbSB7RWxlbWVudH0gY2FudmFzIENhbnZhcyBlbGVtZW50IHdoZXJlIHRoZSBpbnRlcmZhY2UgaXMgZHJhd24uXHJcbiAqIEBwYXJhbSB7RnVuY3Rpb259IG9uSXRlcmF0aW9uIE1ldGhvZCBjYWxsZWQgZXZlcnkgaXRlcmF0aW9uIG9mIHRoZSBzaW11bGF0aW9uIHRvIGNvbnRyb2wgdGhlIGNhcnQuXHJcbiAqIEBwYXJhbSB7RnVuY3Rpb259IG9uR2FtZU92ZXIgTWV0aG9kIGNhbGxlZCB3aGVuIHRoZSBzaW11bGF0aW9uIGVuZHMuXHJcbiAqL1xyXG5SdW5uZXIucnVuR3JhcGhpY2FsID0gZnVuY3Rpb24oY2FudmFzLCBvbkl0ZXJhdGlvbiwgb25HYW1lT3Zlcilcclxue1xyXG4gICAgdmFyIGNhcnQgPSBuZXcgQ2FydCgpO1xyXG4gICAgdmFyIGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xyXG4gICAgdmFyIG1heFBvaW50cyA9IDA7XHJcblxyXG4gICAgZnVuY3Rpb24gbG9vcCgpXHJcbiAgICB7XHJcbiAgICAgICAgaWYob25JdGVyYXRpb24gIT09IHVuZGVmaW5lZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIG9uSXRlcmF0aW9uKGNhcnQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY2FydC51cGRhdGUoKTtcclxuXHJcbiAgICAgICAgaWYoY2FydC5nYW1lT3ZlcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmKG9uR2FtZU92ZXIgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgb25HYW1lT3ZlcihjYXJ0LCBtYXhQb2ludHMpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZihjYXJ0LnNjb3JlID4gbWF4UG9pbnRzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBtYXhQb2ludHMgPSBjYXJ0LnNjb3JlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjYXJ0LnJlc2V0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZW5kZXJcclxuICAgICAgICBjb250ZXh0LnNhdmUoKTtcclxuICAgICAgICBjb250ZXh0LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFRleHQgaW4gdGhlIGNhbnZhc1xyXG4gICAgICAgIGNvbnRleHQuZm9udCA9IFwiMTVweCBBcmlhbFwiO1xyXG4gICAgICAgIGNvbnRleHQudGV4dEFsaWduID0gXCJsZWZ0XCI7XHJcbiAgICAgICAgY29udGV4dC5maWxsVGV4dChcIlBvaW50czogXCIgKyBjYXJ0LnNjb3JlLCAxMCwgMjApO1xyXG4gICAgICAgIGNvbnRleHQuZmlsbFRleHQoXCJNYXg6IFwiICsgbWF4UG9pbnRzLCAxMCwgNDApO1xyXG5cclxuICAgICAgICAvL1RyYW5zZm9ybVxyXG4gICAgICAgIGNvbnRleHQudHJhbnNmb3JtKDEsIDAsIDAsIC0xLCAwLCBjYW52YXMuaGVpZ2h0KTtcclxuICAgICAgICBjb250ZXh0LnRyYW5zbGF0ZShjYW52YXMud2lkdGggLyAyLCBjYW52YXMuaGVpZ2h0IC8gMik7XHJcbiAgICAgICAgY2FydC5kcmF3KGNvbnRleHQpO1xyXG5cclxuICAgICAgICBjb250ZXh0LnJlc3RvcmUoKTtcclxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobG9vcCk7XHJcbiAgICB9XHJcblxyXG4gICAgbG9vcCgpO1xyXG59O1xyXG5cclxuZXhwb3J0IHtSdW5uZXJ9OyIsImltcG9ydCB7UnVubmVyfSBmcm9tIFwiLi9SdW5uZXJcIlxyXG5pbXBvcnQge0xpbmVhck1vZGVsfSBmcm9tIFwiLi9MaW5lYXJNb2RlbFwiXHJcblxyXG4vKipcclxuICogTWV0aG9kcyBmb3IgdHJhaW5pbmcgb2YgdGhlIGNhcnQgbW9kZWwuXHJcbiAqL1xyXG5mdW5jdGlvbiBUcmFpbmluZygpe31cclxuXHJcbi8qKlxyXG4gKiBUcmFpbiB0aGUgbW9kZWwgb2YgdGhlIGNhcnQgaXRlcmF0aXZlbGx5LlxyXG4gKiBcclxuICogVXNlcyBhIHNlYXNvbmFsIHRyYWluaW5nIGFwcHJvYWNoIGZvciB3aWNoIG1hbnkgZXBvY2hzIGFyZSBleGVjdXRlZCBhbmQgdGhlIGJlc3QgZnJvbSBlYWNoIGVwb2NoIGlzIHNlbGVjdGVkIGFzIGJhc2VkIGZvciB0aGUgbmV4dC5cclxuICogXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBlcG9jaHMgTnVtYmVyIG9mIGl0ZXJhdGlvbnMvZXBvY2hzIHRvIHNpbXVsYXRlLlxyXG4gKiBAcGFyYW0ge251bWJlcn0gaXRlcmF0aW9ucyBOdW1iZXIgb2YgdmFyaWF0aW9ucyB0ZXN0ZWQgaW4gZWFjaCBlcG9jaC5cclxuICogQHBhcmFtIHtudW1iZXJ9IHJ1bnMgSG93IG1hbnkgdGltZXMgdG8gcnVuIGVhY2ggdmFyaWF0aW9uIHRvIGdldCBhbiBhdmVyYWdlIHBlcmZvcm1hbmNlLlxyXG4gKiBAcmV0dXJucyB7TGluZWFyTW9kZWx9IFRyYWluZWQgbW9kZWwgdGhhdCBjYW4gYmUgdXNlZCB0byBjb250cm9sIHRoZSBzaW11bGF0aW9uLlxyXG4gKi9cclxuIFRyYWluaW5nLnRyYWluSXRlcmF0aXZlID0gZnVuY3Rpb24oZXBvY2hzLCBpdGVyYXRpb25zLCBydW5zLCBzY29yZUxpbWl0KVxyXG4ge1xyXG5cdGVwb2NocyA9IGVwb2NocyAhPT0gdW5kZWZpbmVkID8gZXBvY2hzIDogNTAwO1xyXG5cdGl0ZXJhdGlvbnMgPSBpdGVyYXRpb25zICE9PSB1bmRlZmluZWQgPyBpdGVyYXRpb25zIDogMTAwO1xyXG5cdHJ1bnMgPSBydW5zICE9PSB1bmRlZmluZWQgPyBydW5zIDogNTtcclxuXHJcblx0Ly8gSWYgdGhlIG1vZGVsIHJlYWNoZXMgdGhpcyBsZXZlbCBvZiBwZXJmb3JtYW5jZSB0aGUgdHJhaW5pbmcgaXMgc3RvcHBlZC5cclxuXHRzY29yZUxpbWl0ID0gc2NvcmVMaW1pdCAhPT0gdW5kZWZpbmVkID8gc2NvcmVMaW1pdCA6IDIwMDAuMDtcclxuXHJcblx0Y29uc29sZS5sb2coXCIgLSBUcmFpbmluZyBwcm9jZXNzIHN0YXJ0aW5nLiBcIiwge2Vwb2NocywgaXRlcmF0aW9ucywgcnVuc30pO1xyXG5cclxuXHR2YXIgYmVzdE1vZGVsID0gbmV3IExpbmVhck1vZGVsKCk7XHJcblx0dmFyIGJlc3RTY29yZSA9IFRyYWluaW5nLnRlc3RNb2RlbChiZXN0TW9kZWwsIHJ1bnMsIHNjb3JlTGltaXQpO1xyXG5cclxuXHR2YXIgaml0dGVyID0gMS4wO1xyXG5cdFxyXG5cdC8vIEVwb2NoXHJcblx0Zm9yKHZhciBlID0gMDsgZSA8IGVwb2NoczsgZSsrKVxyXG5cdHtcclxuXHRcdGNvbnNvbGUubG9nKFwiIC0gUnVubmluZyBlcG9jaCBcIiwgZSwgXCIgc2NvcmUgXCIsIGJlc3RTY29yZSk7XHJcblxyXG5cdFx0dmFyIGVwb2NoTW9kZWwgPSBudWxsO1xyXG5cdFx0dmFyIGVwb2NoU2NvcmUgPSAwO1xyXG5cclxuXHRcdC8vIE51bWJlciBvZiBpdGVyYXRpb25zIHBlciBlcG9jaFxyXG5cdFx0Zm9yKHZhciBpID0gMDsgaSA8IGl0ZXJhdGlvbnM7IGkrKylcclxuXHRcdHtcclxuXHRcdFx0dmFyIG1vZGVsID0gYmVzdE1vZGVsLmNsb25lKCk7XHJcblx0XHRcdG1vZGVsLmppdHRlcihqaXR0ZXIpO1xyXG5cdFx0XHRcclxuXHRcdFx0dmFyIHBvaW50cyA9IFRyYWluaW5nLnRlc3RNb2RlbChtb2RlbCwgcnVucywgc2NvcmVMaW1pdCk7XHJcblx0XHRcdGlmKHBvaW50cyA+IGVwb2NoU2NvcmUpXHJcblx0XHRcdHtcclxuXHRcdFx0XHRlcG9jaE1vZGVsID0gbW9kZWw7XHJcblx0XHRcdFx0ZXBvY2hTY29yZSA9IHBvaW50cztcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGlmKGVwb2NoU2NvcmUgPj0gYmVzdFNjb3JlKVxyXG5cdFx0e1xyXG5cdFx0XHRiZXN0TW9kZWwgPSBlcG9jaE1vZGVsO1xyXG5cdFx0XHRiZXN0U2NvcmUgPSBlcG9jaFNjb3JlO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChiZXN0U2NvcmUgPj0gc2NvcmVMaW1pdClcclxuXHRcdHtcclxuXHRcdFx0YnJlYWs7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRjb25zb2xlLmxvZyhcIiAtIFRyYWluaW5nIGZpbmlzaGVkIHdpdGggc2NvcmUgXCIsIGJlc3RTY29yZSwgXCIgbW9kZWwgXCIsIGJlc3RNb2RlbCk7XHJcblx0cmV0dXJuIGJlc3RNb2RlbDtcclxuIH07XHJcblxyXG4vKipcclxuICogRnVsbHkgcmFuZG9taXplZCB0cmFpbmluZywgdGVzdCBtYW55IHBhcmFtZXRlcnMgYW5kIHNlbGVjdCB0aGUgYmVzdCBmcm9tIGFsbC5cclxuICogXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBpdGVyYXRpb25zIE51bWJlciBvZiB2YXJpYXRpb25zIHRlc3RlZCBpbiBlYWNoIGVwb2NoLlxyXG4gKiBAcGFyYW0ge251bWJlcn0gcnVucyBIb3cgbWFueSB0aW1lcyB0byBydW4gZWFjaCB2YXJpYXRpb24gdG8gZ2V0IGFuIGF2ZXJhZ2UgcGVyZm9ybWFuY2UuXHJcbiAqIEByZXR1cm5zIHtMaW5lYXJNb2RlbH0gVHJhaW5lZCBtb2RlbCB0aGF0IGNhbiBiZSB1c2VkIHRvIGNvbnRyb2wgdGhlIHNpbXVsYXRpb24uXHJcbiAqL1xyXG4gVHJhaW5pbmcudHJhaW5SYW5kb20gPSBmdW5jdGlvbihpdGVyYXRpb25zLCBydW5zLCBzY29yZUxpbWl0KVxyXG4ge1xyXG5cdGl0ZXJhdGlvbnMgPSBpdGVyYXRpb25zICE9PSB1bmRlZmluZWQgPyBpdGVyYXRpb25zIDogMWU1O1xyXG5cdHJ1bnMgPSBydW5zICE9PSB1bmRlZmluZWQgPyBydW5zIDogNTtcclxuXHJcblx0Ly8gSWYgdGhlIG1vZGVsIHJlYWNoZXMgdGhpcyBsZXZlbCBvZiBwZXJmb3JtYW5jZSB0aGUgdHJhaW5pbmcgaXMgc3RvcHBlZC5cclxuXHRzY29yZUxpbWl0ID0gc2NvcmVMaW1pdCAhPT0gdW5kZWZpbmVkID8gc2NvcmVMaW1pdCA6IDIwMDAuMDtcclxuXHJcblx0Y29uc29sZS5sb2coXCIgLSBUcmFpbmluZyBwcm9jZXNzIHN0YXJ0aW5nLiBcIiwge2l0ZXJhdGlvbnMsIHJ1bnN9KTtcclxuXHJcblx0dmFyIGJlc3RNb2RlbCA9IG51bGw7XHJcblx0dmFyIGJlc3RTY29yZSA9IDA7XHJcblx0XHJcblx0dmFyIGppdHRlciA9IDIuMDtcclxuXHJcblx0Ly8gVGVzdHMgcGVyIGVwb2NoXHJcblx0Zm9yKHZhciBpID0gMDsgaSA8IGl0ZXJhdGlvbnM7IGkrKylcclxuXHR7XHJcblx0XHR2YXIgbW9kZWwgPSBuZXcgTGluZWFyTW9kZWwoKTtcclxuXHRcdG1vZGVsLmppdHRlcihqaXR0ZXIpO1xyXG5cdFx0XHJcblx0XHR2YXIgc2NvcmUgPSBUcmFpbmluZy50ZXN0TW9kZWwobW9kZWwsIHJ1bnMsIHNjb3JlTGltaXQpO1xyXG5cdFx0aWYoc2NvcmUgPiBiZXN0U2NvcmUpXHJcblx0XHR7XHJcblx0XHRcdGJlc3RNb2RlbCA9IG1vZGVsO1xyXG5cdFx0XHRiZXN0U2NvcmUgPSBzY29yZTtcclxuXHRcdH1cclxuXHJcblx0XHRjb25zb2xlLmxvZyhcIiAtIEl0ZXJhdGlvbiBcIiwgaSwgXCIgc2NvcmUgXCIsIGJlc3RTY29yZSk7XHJcblxyXG5cdFx0aWYgKGJlc3RTY29yZSA+PSBzY29yZUxpbWl0KVxyXG5cdFx0e1xyXG5cdFx0XHRicmVhaztcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGNvbnNvbGUubG9nKFwiIC0gVHJhaW5pbmcgZmluaXNoZWQgd2l0aCBzY29yZSBcIiwgYmVzdFNjb3JlLCBcIiBtb2RlbCBcIiwgYmVzdE1vZGVsKTtcclxuXHJcblx0cmV0dXJuIGJlc3RNb2RlbDtcclxufVxyXG5cclxuLyoqXHJcbiAqIFJ1biB0aGUgbW9kZWwsIG11bHRpcGxlIHRpbWVzIGFuZCBhdmVyYWdlIHRoZSBwb250dWF0aW9uIG9mIHRoZSBydW5zLlxyXG4gKiBcclxuICogQHBhcmFtIHtMaW5lYXJNb2RlbH0gbW9kZWwgTW9kZWwgdG8gYmUgdGVzdGVkLlxyXG4gKiBAcGFyYW0ge251bWJlcn0gcnVucyBOdW1iZXIgb2YgaXRlcmF0aW9ucyB0byB0ZXN0IHRoZSBtb2RlbC5cclxuICogQHBhcmFtIHtudW1iZXJ9IHNjb3JlTGltaXQgSWYgdGhlIHNjb3JlIG9mIHRoZSBtb2RlbCBnZXRzIGJldHRlciB0aGFuIHRoZSBsaW1pdCB0aGUgc2ltdWxhdGlvbiBzdG9wcy5cclxuICogQHJldHVybiB7bnVtYmVyfSBUaGUgYXZlcmFnZSBwZXJmb3JtYW5jZSBzY29yZSBvZiB0aGUgbW9kZWwuXHJcbiAqL1xyXG5UcmFpbmluZy50ZXN0TW9kZWwgPSBmdW5jdGlvbihtb2RlbCwgcnVucywgc2NvcmVMaW1pdClcclxue1xyXG5cdHZhciBzY29yZSA9IDA7XHJcblx0Zm9yKHZhciByID0gMDsgciA8IHJ1bnM7IHIrKylcclxuXHR7XHJcblx0XHRzY29yZSArPSBSdW5uZXIucnVuSGVhZGxlc3MoZnVuY3Rpb24oY2FydClcclxuXHRcdHtcclxuXHRcdFx0bW9kZWwuY29udHJvbChjYXJ0KTtcclxuXHRcdH0sIHNjb3JlTGltaXQpO1xyXG5cdH1cclxuXHRyZXR1cm4gc2NvcmUgLyBydW5zO1xyXG59O1xyXG5cclxuZXhwb3J0IHtUcmFpbmluZ307IiwiLyoqXHJcbiAqIEF1eGlsaWFyIG1ldGhvZHMuXHJcbiAqL1xyXG5mdW5jdGlvbiBVdGlscygpIHt9XHJcblxyXG4vKipcclxuICogV3JpdGUgZGF0YSBpbnRvIGEgZmlsZS4gVXNlZnVsIHRvIGV4cG9ydCBKU09OIGRhdGEuXHJcbiAqIFxyXG4gKiBAcGFyYW0ge3N0cmluZyB8IG9iamVjdH0gZGF0YSBEYXRhIHRvIGJlIHdyaXR0ZW4gdG8gZmlsZS4gXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBmbmFtZSBOYW1lIG9mIHRoZSBmaWxlIHRvIGJlIHdyaXR0ZW4uXHJcbiAqL1xyXG5VdGlscy53cml0ZUZpbGUgPSBmdW5jdGlvbihkYXRhLCBmbmFtZSlcclxue1xyXG4gICAgaWYgKHR5cGVvZiBkYXRhID09PSAnb2JqZWN0JylcclxuICAgIHtcclxuICAgICAgICBkYXRhID0gSlNPTi5zdHJpbmdpZnkoZGF0YSwgbnVsbCwgJ1xcdCcpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICB2YXIgYmxvYiA9IG5ldyBCbG9iKFtkYXRhXSwge3R5cGU6ICdvY3RldC9zdHJlYW0nfSk7XHJcbiAgICBcclxuICAgIHZhciBkb3dubG9hZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgIGRvd25sb2FkLmRvd25sb2FkID0gZm5hbWU7XHJcbiAgICBkb3dubG9hZC5ocmVmID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XHJcbiAgICBkb3dubG9hZC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgZG93bmxvYWQub25jbGljayA9IGZ1bmN0aW9uICgpXHJcbiAgICB7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzKTtcclxuICAgIH07XHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRvd25sb2FkKTtcclxuICAgIFxyXG4gICAgZG93bmxvYWQuY2xpY2soKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDaG9vc2UgZmlsZSBhbmQgcmVhZCBkYXRhIGZyb20gaXQuXHJcbiAqL1xyXG5VdGlscy5yZWFkRmlsZSA9IGZ1bmN0aW9uKG9uTG9hZClcclxue1xyXG4gICAgdmFyIGNob29zZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XHJcblx0Y2hvb3Nlci50eXBlID0gXCJmaWxlXCI7XHJcblx0Y2hvb3Nlci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcblx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjaG9vc2VyKTtcclxuXHJcblx0Y2hvb3Nlci5vbmNoYW5nZSA9IGZ1bmN0aW9uKClcclxuXHR7XHRcclxuICAgICAgICB2YXIgZmlsZXMgPSBjaG9vc2VyLmZpbGVzO1xyXG4gICAgICAgIGlmIChmaWxlcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgdGV4dCA9IHJlYWRlci5yZXN1bHQ7XHJcbiAgICAgICAgICAgIG9uTG9hZCh0ZXh0KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJlYWRlci5yZWFkQXNUZXh0KGZpbGVzWzBdKTtcclxuXHJcblx0XHRkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGNob29zZXIpO1xyXG5cdH07XHJcblxyXG5cdGNob29zZXIuY2xpY2soKTtcclxufTtcclxuXHJcbmV4cG9ydCB7VXRpbHN9OyJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJkZWZpbmUiLCJhbWQiLCJzZWxmIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJCb3giLCJtaW4iLCJtYXgiLCJ0aGlzIiwiTGluZSIsIm9yaWdpbiIsImVuZCIsIkNhcnQiLCJiYXJyaWVyRGlzdGFuY2UiLCJib3hIYWxmU2l6ZSIsIm1vdmVBY2NlbGVyYXRpb24iLCJsaW1pdEFuZ2xlIiwiY2FydCIsIlZlY3RvcjIiLCJwZW5kdWx1bSIsImJhcnJpZXJMZWZ0IiwiYmFycmllclJpZ2h0IiwicmVzZXQiLCJMaW5lYXJSZWdyZXNzaW9uIiwib3JpIiwiZGVjbCIsIkxpbmVhck1vZGVsIiwidmVsIiwiYW5nbGUiLCJwb3MiLCJlIiwiUnVubmVyIiwiVHJhaW5pbmciLCJVdGlscyIsImNvbnN0cnVjdG9yIiwieCIsInkiLCJnZXRTaXplIiwiZHJhdyIsImNvbnRleHQiLCJzaXplIiwibGluZVdpZHRoIiwic3Ryb2tlUmVjdCIsIk1hdGgiLCJzcXJ0IiwicG93IiwiYmVnaW5QYXRoIiwibW92ZVRvIiwibGluZVRvIiwic3Ryb2tlIiwiZ2FtZU92ZXIiLCJzY29yZSIsInBvc2l0aW9uIiwibGVmdFByZXNzZWQiLCJyaWdodFByZXNzZWQiLCJhY2NlbGVyYXRpb24iLCJmcmljdGlvbiIsInZlbG9jaXR5IiwicmFuZG9tIiwidHJhbnNsYXRlIiwic3Ryb2tlU3R5bGUiLCJzaW4iLCJjb3MiLCJ1cGRhdGUiLCJqaXR0ZXIiLCJzY2FsZSIsImNsb25lIiwibSIsImNvbnRyb2wiLCJ2IiwicnVuSGVhZGxlc3MiLCJsb2dpY0NhbGxiYWNrIiwicG9pbnRMaW1pdCIsImxvZ1BlcmZvcm1hbmNlIiwidW5kZWZpbmVkIiwiSW5maW5pdHkiLCJ0aW1lIiwicGVyZm9ybWFuY2UiLCJub3ciLCJjb25zb2xlIiwibG9nIiwicnVuR3JhcGhpY2FsIiwiY2FudmFzIiwib25JdGVyYXRpb24iLCJvbkdhbWVPdmVyIiwiZ2V0Q29udGV4dCIsIm1heFBvaW50cyIsImxvb3AiLCJzYXZlIiwiY2xlYXJSZWN0Iiwid2lkdGgiLCJoZWlnaHQiLCJmb250IiwidGV4dEFsaWduIiwiZmlsbFRleHQiLCJ0cmFuc2Zvcm0iLCJyZXN0b3JlIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwidHJhaW5JdGVyYXRpdmUiLCJlcG9jaHMiLCJpdGVyYXRpb25zIiwicnVucyIsInNjb3JlTGltaXQiLCJiZXN0TW9kZWwiLCJiZXN0U2NvcmUiLCJ0ZXN0TW9kZWwiLCJlcG9jaE1vZGVsIiwiZXBvY2hTY29yZSIsImkiLCJtb2RlbCIsInBvaW50cyIsInRyYWluUmFuZG9tIiwiciIsIndyaXRlRmlsZSIsImRhdGEiLCJmbmFtZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJibG9iIiwiQmxvYiIsInR5cGUiLCJkb3dubG9hZCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImhyZWYiLCJ3aW5kb3ciLCJVUkwiLCJjcmVhdGVPYmplY3RVUkwiLCJzdHlsZSIsImRpc3BsYXkiLCJvbmNsaWNrIiwiYm9keSIsInJlbW92ZUNoaWxkIiwiYXBwZW5kQ2hpbGQiLCJjbGljayIsInJlYWRGaWxlIiwib25Mb2FkIiwiY2hvb3NlciIsIm9uY2hhbmdlIiwiZmlsZXMiLCJsZW5ndGgiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwib25sb2FkIiwidGV4dCIsInJlc3VsdCIsInJlYWRBc1RleHQiXSwic291cmNlUm9vdCI6IiJ9